#DPATCHLEVEL=0

2005-12-28  Samuel Thibault  <samuel.thibault@ens-lyon.org>

	* i386/i386/iopb.c (i386_io_port_remove): Fix unlocking when io mapping
	is not found.


Index: i386/i386/iopb.c
===================================================================
--- i386/i386/iopb.c.orig	2006-11-14 03:58:56.000000000 +0200
+++ i386/i386/iopb.c	2006-11-14 04:15:49.000000000 +0200
@@ -471,6 +471,10 @@ i386_io_port_remove(thread, device)
 	/*
 	 * No mapping.
 	 */
+
+	simple_unlock(&pcb->lock);
+	simple_unlock(&iopb_lock);
+
 	return KERN_INVALID_ARGUMENT;
 }
 
