#DPATCHLEVEL=1

2006-01-02  Samuel Thibault <samuel.thibault@ens-lyon.org>

	* i386/i386/iopb.c (i386_io_port_add): Fix getting device parameter.
	(i386_io_port_remove): Same as above.


Index: i386/i386/iopb.c
===================================================================
--- i386/i386/iopb.c.orig	2006-11-14 04:15:57.000000000 +0200
+++ i386/i386/iopb.c	2006-11-14 04:16:04.000000000 +0200
@@ -310,12 +310,22 @@ iopb_destroy(
 /*
  * Add an IO mapping to a thread.
  */
+#ifdef i386
+kern_return_t
+i386_io_port_add(
+	thread_t	thread,
+	device_t	d)
+#else
 kern_return_t
 i386_io_port_add(
 	thread_t	thread,
 	mach_device_t	device)
+#endif
 {
 	pcb_t		pcb;
+#ifdef i386
+	mach_device_t	device = d->emul_data;
+#endif
 	iopb_tss_t	io_tss, new_io_tss;
 	io_port_t	io_port;
 	io_use_t	iu, old_iu;
@@ -409,12 +419,22 @@ i386_io_port_add(
 /*
  * Remove an IO mapping from a thread.
  */
+#ifdef i386
+kern_return_t
+i386_io_port_remove(thread, d)
+	thread_t	thread;
+	device_t	d;
+#else
 kern_return_t
 i386_io_port_remove(thread, device)
 	thread_t	thread;
 	mach_device_t	device;
+#endif
 {
 	pcb_t		pcb;
+#ifdef i386
+	mach_device_t	device = d->emul_data;
+#endif
 	iopb_tss_t	io_tss;
 	io_port_t	io_port;
 	io_use_t	iu;
